!function(i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),i(t)}:i(window.jQuery)}(function(O){O.extend(O.FE.POPUP_TEMPLATES,{"file.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_PROGRESS_BAR_]"}),O.extend(O.FE.DEFAULTS,{fileUploadURL:"https://i.froala.com/upload",fileUploadParam:"file",fileUploadParams:{},fileUploadToS3:!1,fileUploadMethod:"POST",fileMaxSize:10485760,fileAllowedTypes:["*"],fileInsertButtons:["fileBack","|"],fileUseSelectedText:!1}),O.FE.PLUGINS.file=function(s){function e(){var e=s.$tb.find('.fr-command[data-cmd="insertFile"]'),t=s.popups.get("file.insert");if(t||(t=y()),o(),!t.hasClass("fr-active")){s.popups.refresh("file.insert"),s.popups.setContainer("file.insert",s.$tb);var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+(s.opts.toolbarBottom?0:e.outerHeight());s.popups.show("file.insert",i,r,e.outerHeight())}}function l(){var e=s.popups.get("file.insert");e||(e=y()),e.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),e.find(".fr-file-progress-bar-layer").addClass("fr-active"),e.find(".fr-buttons").hide(),r(s.language.translate("Uploading"),0)}function o(e){var t=s.popups.get("file.insert");t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-file-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e&&(s.events.focus(),s.popups.hide("file.insert")))}function r(e,t){var i=s.popups.get("file.insert");if(i){var r=i.find(".fr-file-progress-bar-layer");r.find("h3").text(e+(t?" "+t+"%":"")),r.removeClass("fr-error"),t?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width",t+"%")):r.find("div").addClass("fr-indeterminate")}}function i(e){l();var t=s.popups.get("file.insert").find(".fr-file-progress-bar-layer");t.addClass("fr-error");var i=t.find("h3");i.text(e),s.events.disableBlur(),i.focus()}function f(e,t,i){s.edit.on(),s.events.focus(!0),s.selection.restore(),s.opts.fileUseSelectedText&&s.selection.text().length&&(t=s.selection.text()),s.html.insert('<a href="'+e+'" id="fr-inserted-file" class="fr-file">'+t+"</a>");var r=s.$el.find("#fr-inserted-file");r.removeAttr("id"),s.popups.hide("file.insert"),s.undo.saveStep(),T(),s.events.trigger("file.inserted",[r,i])}function p(e){try{if(!1===s.events.trigger("file.uploaded",[e],!0))return s.edit.on(),!1;var t=JSON.parse(e);return t.link?t:(g(k,e),!1)}catch(l){return g(x,e),!1}}function d(e){try{var t=O(e).find("Location").text(),i=O(e).find("Key").text();return!1===s.events.trigger("file.uploadedToS3",[t,i,e],!0)?(s.edit.on(),!1):t}catch(r){return g(x,e),!1}}function u(e){var t=this.status,i=this.response,r=this.responseXML,o=this.responseText;try{if(s.opts.fileUploadToS3)if(201==t){var n=d(r);n&&f(n,e,i||r)}else g(x,i||r);else if(200<=t&&t<300){var a=p(o);a&&f(a.link,e,i||o)}else g(w,i||o)}catch(c){g(x,i||o)}}function c(){g(x,this.response||this.responseText||this.responseXML)}function v(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;r(s.language.translate("Uploading"),t)}}function g(e,t){s.edit.on(),i(s.language.translate("Something went wrong. Please try again.")),s.events.trigger("file.error",[{code:e,message:F[e]},t])}function h(){s.edit.on(),o(!0)}function n(e){if(void 0!==e&&0<e.length){if(!1===s.events.trigger("file.beforeUpload",[e]))return!1;var t,i=e[0];if(i.size>s.opts.fileMaxSize)return g(P),!1;if(s.opts.fileAllowedTypes.indexOf("*")<0&&s.opts.fileAllowedTypes.indexOf(i.type.replace(/file\//g,""))<0)return g(A),!1;if(s.drag_support.formdata&&(t=s.drag_support.formdata?new FormData:null),t){var r;if(!1!==s.opts.fileUploadToS3)for(r in t.append("key",s.opts.fileUploadToS3.keyStart+(new Date).getTime()+"-"+(i.name||"untitled")),t.append("success_action_status","201"),t.append("X-Requested-With","xhr"),t.append("Content-Type",i.type),s.opts.fileUploadToS3.params)s.opts.fileUploadToS3.params.hasOwnProperty(r)&&t.append(r,s.opts.fileUploadToS3.params[r]);for(r in s.opts.fileUploadParams)s.opts.fileUploadParams.hasOwnProperty(r)&&t.append(r,s.opts.fileUploadParams[r]);t.append(s.opts.fileUploadParam,i);var o=s.opts.fileUploadURL;s.opts.fileUploadToS3&&(o=s.opts.fileUploadToS3.uploadURL?s.opts.fileUploadToS3.uploadURL:"https://"+s.opts.fileUploadToS3.region+".amazonaws.com/"+s.opts.fileUploadToS3.bucket);var n=s.core.getXHR(o,s.opts.fileUploadMethod);n.onload=function(){u.call(n,i.name)},n.onerror=c,n.upload.onprogress=v,n.onabort=h,l(),s.edit.off();var a=s.popups.get("file.insert");a&&a.off("abortUpload").on("abortUpload",function(){4!=n.readyState&&n.abort()}),n.send(t)}}}function a(i){s.events.$on(i,"dragover dragenter",".fr-file-upload-layer",function(){return O(this).addClass("fr-drop"),!1},!0),s.events.$on(i,"dragleave dragend",".fr-file-upload-layer",function(){return O(this).removeClass("fr-drop"),!1},!0),s.events.$on(i,"drop",".fr-file-upload-layer",function(e){e.preventDefault(),e.stopPropagation(),O(this).removeClass("fr-drop");var t=e.originalEvent.dataTransfer;t&&t.files&&(i.data("instance")||s).file.upload(t.files)},!0),s.helpers.isIOS()&&s.events.$on(i,"touchstart",'.fr-file-upload-layer input[type="file"]',function(){O(this).trigger("click")}),s.events.$on(i,"change",'.fr-file-upload-layer input[type="file"]',function(){this.files&&(i.data("instance")||s).file.upload(this.files),O(this).val("")},!0)}function m(){o()}function y(e){if(e)return s.popups.onHide("file.insert",m),!0;var t={buttons:'<div class="fr-buttons">'+s.button.buildList(s.opts.fileInsertButtons)+"</div>",upload_layer:'<div class="fr-file-upload-layer fr-layer fr-active" id="fr-file-upload-layer-'+s.id+'"><strong>'+s.language.translate("Drop file")+"</strong><br>("+s.language.translate("or click")+')<div class="fr-form"><input type="file" name="'+s.opts.fileUploadParam+'" accept="/*" tabIndex="-1" aria-labelledby="fr-file-upload-layer-'+s.id+'" role="button"></div></div>',progress_bar:'<div class="fr-file-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="fileDismissError" tabIndex="2" role="button">OK</button></div></div>'},i=s.popups.create("file.insert",t);return a(i),i}function t(e){s.node.hasClass(e,"fr-file")}function b(e){var t=e.originalEvent.dataTransfer;if(t&&t.files&&t.files.length){var i=t.files[0];if(i&&void 0!==i.type&&i.type.indexOf("image")<0&&(0<=s.opts.fileAllowedTypes.indexOf(i.type)||0<=s.opts.fileAllowedTypes.indexOf("*"))){s.markers.remove(),s.markers.insertAtPoint(e.originalEvent),s.$el.find(".fr-marker").replaceWith(O.FE.MARKERS),s.popups.hideAll();var r=s.popups.get("file.insert");return r||(r=y()),s.popups.setContainer("file.insert",s.$sc),s.popups.show("file.insert",e.originalEvent.pageX,e.originalEvent.pageY),l(),n(t.files),e.preventDefault(),e.stopPropagation(),!1}}}function U(){s.events.on("drop",b),s.events.$on(s.$win,"keydown",function(e){var t=e.which,i=s.popups.get("file.insert");i&&t==O.FE.KEYCODE.ESC&&i.trigger("abortUpload")}),s.events.on("destroy",function(){var e=s.popups.get("file.insert");e&&e.trigger("abortUpload")})}function S(){s.events.disableBlur(),s.selection.restore(),s.events.enableBlur(),s.popups.hide("file.insert"),s.toolbar.showInline()}function T(){var e,t=Array.prototype.slice.call(s.el.querySelectorAll("a.fr-file")),i=[];for(e=0;e<t.length;e++)i.push(t[e].getAttribute("href"));if(E)for(e=0;e<E.length;e++)i.indexOf(E[e].getAttribute("href"))<0&&s.events.trigger("file.unlink",[E[e]]);E=t}function C(){U(),s.events.on("link.beforeRemove",t),s.$wp&&(T(),s.events.on("contentChanged",T)),y(!0)}var E,k=2,w=3,x=4,P=5,A=6,F={};return F[1]="File cannot be loaded from the passed link.",F[k]="No link in upload response.",F[w]="Error during file upload.",F[x]="Parsing response failed.",F[P]="File is too large.",F[A]="File file type is invalid.",F[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",{_init:C,showInsertPopup:e,upload:n,insert:f,back:S,hideProgressBar:o}},O.FE.DefineIcon("insertFile",{NAME:"file-o"}),O.FE.RegisterCommand("insertFile",{title:"Upload File",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("file.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("file.insert")):this.file.showInsertPopup()},plugin:"file"}),O.FE.DefineIcon("fileBack",{NAME:"arrow-left"}),O.FE.RegisterCommand("fileBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.file.back()},refresh:function(e){this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),O.FE.RegisterCommand("fileDismissError",{title:"OK",callback:function(){this.file.hideProgressBar(!0)}})});