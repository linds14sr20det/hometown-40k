!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,a){return void 0===a&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(a)}:t(window.jQuery)}(function(W){if(W.extend(W.FE.DEFAULTS,{imageManagerLoadURL:"https://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:"",imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),W.FE.PLUGINS.imageManager=function(s){function t(){if(!D){var e='<div class="fr-modal-head-line"><i class="fa fa-bars fr-modal-more fr-not-available" id="fr-modal-more-'+s.sid+'" title="'+s.language.translate("Tags")+'"></i><h4 data-text="true">'+s.language.translate("Manage Images")+"</h4></div>";e+='<div class="fr-modal-tags" id="fr-modal-tags"></div>';var a='<img class="fr-preloader" id="fr-preloader" alt="'+s.language.translate("Loading")+'.." src="'+s.opts.imageManagerPreloader+'" style="display: none;">';a+='<div class="fr-image-list" id="fr-image-list"></div>';var t=s.modals.create(H,e,a);D=t.$modal,I=t.$head,x=t.$body}D.data("current-image",s.image.get()),s.modals.show(H),P||L(),n()}function e(){s.modals.hide(H)}function r(){var e=W(window).outerWidth();return e<768?2:e<1200?3:4}function i(){E.empty();for(var e=0;e<F;e++)E.append('<div class="fr-list-column"></div>')}function n(){P.show(),E.find(".fr-list-column").empty(),s.opts.imageManagerLoadURL?W.ajax({url:s.opts.imageManagerLoadURL,method:s.opts.imageManagerLoadMethod,data:s.opts.imageManagerLoadParams,dataType:"json",crossDomain:s.opts.requestWithCORS,xhrFields:{withCredentials:s.opts.requestWithCredentials},headers:s.opts.requestHeaders}).done(function(e,a,t){s.events.trigger("imageManager.imagesLoaded",[e]),o(e,t.response),P.hide()}).fail(function(){var e=this.xhr();v(k,e.response||e.responseText)}):v(O)}function o(e,a){try{E.find(".fr-list-column").empty(),U=R=S=0,q=e,g()}catch(t){v(z,a)}}function g(){if(R<q.length&&(E.outerHeight()<=x.outerHeight()+s.opts.imageManagerScrollOffset||x.scrollTop()+s.opts.imageManagerScrollOffset>E.outerHeight()-x.outerHeight())){S++;for(var e=s.opts.imageManagerPageSize*(S-1);e<Math.min(q.length,s.opts.imageManagerPageSize*S);e++)a(q[e])}}function a(i){var n=new Image,o=W('<div class="fr-image-container fr-empty fr-image-'+U+++'" data-loading="'+s.language.translate("Loading")+'.." data-deleting="'+s.language.translate("Deleting")+'..">');f(!1),n.onload=function(){o.height(Math.floor(o.width()/n.width*n.height));var t=W("<img/>");if(i.thumb)t.attr("src",i.thumb);else{if(v(_,i),!i.url)return v(A,i),!1;t.attr("src",i.url)}if(i.url&&t.attr("data-url",i.url),i.tag)if(I.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),I.find(".fr-modal-tags").show(),0<=i.tag.indexOf(",")){for(var e=i.tag.split(","),a=0;a<e.length;a++)e[a]=e[a].trim(),0===T.find('a[title="'+e[a]+'"]').length&&T.append('<a role="button" title="'+e[a]+'">'+e[a]+"</a>");t.attr("data-tag",e.join())}else 0===T.find('a[title="'+i.tag.trim()+'"]').length&&T.append('<a role="button" title="'+i.tag.trim()+'">'+i.tag.trim()+"</a>"),t.attr("data-tag",i.tag.trim());for(var r in i.name&&t.attr("alt",i.name),i)i.hasOwnProperty(r)&&"thumb"!=r&&"url"!=r&&"tag"!=r&&t.attr("data-"+r,i[r]);o.append(t).append(W(s.icon.create("imageManagerDelete")).addClass("fr-delete-img").attr("title",s.language.translate("Delete"))).append(W(s.icon.create("imageManagerInsert")).addClass("fr-insert-img").attr("title",s.language.translate("Insert"))),T.find(".fr-selected-tag").each(function(e,a){C(t,a.text)||o.hide()}),t.on("load",function(){o.removeClass("fr-empty"),o.height("auto"),R++,m(d(parseInt(t.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1)),f(!1),R%s.opts.imageManagerPageSize==0&&g()}),s.events.trigger("imageManager.imageLoaded",[t])},n.onerror=function(){R++,o.remove(),m(d(parseInt(o.attr("class").match(/fr-image-(\d+)/)[1],10)+1)),v(j,i),R%s.opts.imageManagerPageSize==0&&g()},n.src=i.thumb||i.url,l().append(o)}function l(){var r,i;return E.find(".fr-list-column").each(function(e,a){var t=W(a);0===e?(i=t.outerHeight(),r=t):t.outerHeight()<i&&(i=t.outerHeight(),r=t)}),r}function d(e){void 0===e&&(e=0);for(var a=[],t=U-1;e<=t;t--){var r=E.find(".fr-image-"+t);r.length&&(a.push(r),W('<div id="fr-image-hidden-container">').append(r),E.find(".fr-image-"+t).remove())}return a}function m(e){for(var a=e.length-1;0<=a;a--)l().append(e[a])}function f(e){if(void 0===e&&(e=!0),!D.is(":visible"))return!0;var a=r();if(a!=F){F=a;var t=d();i(),m(t)}s.modals.resize(H),e&&g()}function u(e){var a={},t=e.data();for(var r in t)t.hasOwnProperty(r)&&"url"!=r&&"tag"!=r&&(a[r]=t[r]);return a}function c(e){var a=W(e.currentTarget).siblings("img"),t=D.data("instance")||s,r=D.data("current-image");if(s.modals.hide(H),t.image.showProgressBar(),r)r.data("fr-old-src",r.attr("src")),r.trigger("click");else{t.events.focus(!0),t.selection.restore();var i=t.position.getBoundingRect(),n=i.left+i.width/2+W(s.doc).scrollLeft(),o=i.top+i.height+W(s.doc).scrollTop();t.popups.setContainer("image.insert",s.$sc),t.popups.show("image.insert",n,o)}t.image.insert(a.data("url"),!1,u(a),r)}function h(){D.find("#fr-modal-tags > a").each(function(){0===D.find('#fr-image-list [data-tag*="'+W(this).text()+'"]').length&&W(this).removeClass("fr-selected-tag").hide()}),w()}function p(e){var t=W(e.currentTarget).siblings("img"),a=s.language.translate("Are you sure? Image will be deleted.");confirm(a)&&(s.opts.imageManagerDeleteURL?!1!==s.events.trigger("imageManager.beforeDeleteImage",[t])&&(t.parent().addClass("fr-image-deleting"),W.ajax({method:s.opts.imageManagerDeleteMethod,url:s.opts.imageManagerDeleteURL,data:W.extend(W.extend({src:t.attr("src")},u(t)),s.opts.imageManagerDeleteParams),crossDomain:s.opts.requestWithCORS,xhrFields:{withCredentials:s.opts.requestWithCredentials},headers:s.opts.requestHeaders}).done(function(e){s.events.trigger("imageManager.imageDeleted",[e]);var a=d(parseInt(t.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);t.parent().remove(),m(a),h(),f(!0)}).fail(function(){var e=this.xhr();v(N,e.response||e.responseText)})):v($))}function v(e,a){10<=e&&e<20?P.hide():20<=e&&e<30&&W(".fr-image-deleting").removeClass("fr-image-deleting"),s.events.trigger("imageManager.error",[{code:e,message:B[e]},a])}function M(){var e=I.find(".fr-modal-head-line").outerHeight(),a=T.outerHeight();I.toggleClass("fr-show-tags"),I.hasClass("fr-show-tags")?(I.css("height",e+a),T.find("a").css("opacity",1)):(I.css("height",e),T.find("a").css("opacity",0))}function w(){var e=T.find(".fr-selected-tag");0<e.length?(E.find("img").parent().show(),e.each(function(e,r){E.find("img").each(function(e,a){var t=W(a);C(t,r.text)||t.parent().hide()})})):E.find("img").parent().show(),m(d()),g()}function b(e){e.preventDefault();var a=W(e.currentTarget);a.toggleClass("fr-selected-tag"),s.opts.imageManagerToggleTags&&a.siblings("a").removeClass("fr-selected-tag"),w()}function C(e,a){for(var t=(e.attr("data-tag")||"").split(","),r=0;r<t.length;r++)if(t[r]==a)return!0;return!1}function L(){P=D.find("#fr-preloader"),E=D.find("#fr-image-list"),T=D.find("#fr-modal-tags"),F=r(),i(),I.css("height",I.find(".fr-modal-head-line").outerHeight()),s.events.$on(W(s.o_win),"resize",function(){f(!!q)}),s.helpers.isMobile()&&(s.events.bindClick(E,"div.fr-image-container",function(e){D.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),W(e.currentTarget).addClass("fr-mobile-selected")}),D.on(s._mousedown,function(){D.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),s.events.bindClick(E,".fr-insert-img",c),s.events.bindClick(E,".fr-delete-img",p),D.on(s._mousedown+" "+s._mouseup,function(e){e.stopPropagation()}),D.on(s._mousedown,"*",function(){s.events.disableBlur()}),x.on("scroll",g),s.events.bindClick(D,"i#fr-modal-more-"+s.sid,M),s.events.bindClick(T,"a",b)}function y(){if(!s.$wp&&"IMG"!=s.el.tagName)return!1}var D,I,x,P,E,T,q,S,R,U,F,H="image_manager",j=10,k=11,O=12,z=13,_=14,A=15,N=21,$=22,B={};return B[j]="Image cannot be loaded from the passed link.",B[k]="Error during load images request.",B[O]="Missing imageManagerLoadURL option.",B[z]="Parsing load response failed.",B[_]="Missing image thumb.",B[A]="Missing image URL.",B[N]="Error during delete image request.",B[$]="Missing imageManagerDeleteURL option.",{require:["image"],_init:y,show:t,hide:e}},!W.FE.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");W.FE.DEFAULTS.imageInsertButtons.push("imageManager"),W.FE.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,modal:!0,callback:function(){this.imageManager.show()},plugin:"imageManager"}),W.FE.DefineIcon("imageManager",{NAME:"folder"}),W.FE.DefineIcon("imageManagerInsert",{NAME:"plus"}),W.FE.DefineIcon("imageManagerDelete",{NAME:"trash"})});