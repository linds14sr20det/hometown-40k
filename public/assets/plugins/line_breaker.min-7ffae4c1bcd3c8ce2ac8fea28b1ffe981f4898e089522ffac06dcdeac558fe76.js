!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t)}:n(window.jQuery)}(function(b){b.extend(b.FE.DEFAULTS,{lineBreakerTags:["table","hr","form","dl","span.fr-video"],lineBreakerOffset:15,lineBreakerHorizontalOffset:10}),b.FE.PLUGINS.lineBreaker=function(g){function s(e,t){var n,r,o,a,i,s,f,l;if(null==e)i=(a=t.parent()).offset().top,n=(f=t.offset().top)-Math.min((f-i)/2,g.opts.lineBreakerOffset),o=a.outerWidth(),r=a.offset().left;else if(null==t)s=(a=e.parent()).offset().top+a.outerHeight(),n=(l=e.offset().top+e.outerHeight())+Math.min((s-l)/2,g.opts.lineBreakerOffset),o=a.outerWidth(),r=a.offset().left;else{a=e.parent();var u=e.offset().top+e.height(),p=t.offset().top;if(p<u)return!1;n=(u+p)/2,o=a.outerWidth(),r=a.offset().left}g.opts.iframe&&(r+=g.$iframe.offset().left-g.helpers.scrollLeft(),n+=g.$iframe.offset().top-g.helpers.scrollTop()),g.$box.append(v),v.css("top",n-g.win.pageYOffset),v.css("left",r-g.win.pageXOffset),v.css("width",o),v.data("tag1",e),v.data("tag2",t),v.addClass("fr-visible").data("instance",g)}function o(e,t){var n,r,o=e.offset().top,a=e.offset().top+e.outerHeight();if(Math.abs(a-t)<=g.opts.lineBreakerOffset||Math.abs(t-o)<=g.opts.lineBreakerOffset)if(Math.abs(a-t)<Math.abs(t-o)){for(var i=(r=e.get(0)).nextSibling;i&&i.nodeType==Node.TEXT_NODE&&0===i.textContent.length;)i=i.nextSibling;if(!i)return s(e,null),!0;if(n=f(i))return s(e,n),!0}else{if(!(r=e.get(0)).previousSibling)return s(null,e),!0;if(n=f(r.previousSibling))return s(n,e),!0}v.removeClass("fr-visible").removeData("instance")}function f(e){if(e){var t=b(e);if(0===g.$el.find(t).length)return null;if(e.nodeType!=Node.TEXT_NODE&&t.is(g.opts.lineBreakerTags.join(",")))return t;if(0<t.parents(g.opts.lineBreakerTags.join(",")).length)return e=t.parents(g.opts.lineBreakerTags.join(",")).get(0),0!==g.$el.find(e).length&&b(e).is(g.opts.lineBreakerTags.join(","))?b(e):null}return null}function a(e,t){var n=g.doc.elementFromPoint(e,t);return n&&!b(n).closest(".fr-line-breaker").length&&!g.node.isElement(n)&&n!=g.$wp.get(0)&&b(n).closest(g.$wp).length?n:null}function i(e,t,n){for(var r=n,o=null;r<=g.opts.lineBreakerOffset&&!o;)(o=a(e,t-r))||(o=a(e,t+r)),r+=n;return o}function l(e,t,n){for(var r=null;!r&&e>g.$box.offset().left&&e<g.$box.offset().left+g.$box.outerWidth();)(r=a(e,t))||(r=i(e,t,5)),"left"==n?e-=g.opts.lineBreakerHorizontalOffset:e+=g.opts.lineBreakerHorizontalOffset;return r}function t(e){var t=h=null,n=null,r=g.doc.elementFromPoint(e.pageX-g.win.pageXOffset,e.pageY-g.win.pageYOffset);r&&("HTML"==r.tagName||"BODY"==r.tagName||g.node.isElement(r)||0<=(r.getAttribute("class")||"").indexOf("fr-line-breaker"))?((n=i(e.pageX-g.win.pageXOffset,e.pageY-g.win.pageYOffset,1))||(n=l(e.pageX-g.win.pageXOffset-g.opts.lineBreakerHorizontalOffset,e.pageY-g.win.pageYOffset,"left")),n||(n=l(e.pageX-g.win.pageXOffset+g.opts.lineBreakerHorizontalOffset,e.pageY-g.win.pageYOffset,"right")),t=f(n)):t=f(r),t?o(t,e.pageY):g.core.sameInstance(v)&&v.removeClass("fr-visible").removeData("instance")}function e(e){return!(v.hasClass("fr-visible")&&!g.core.sameInstance(v))&&(g.popups.areVisible()||g.el.querySelector(".fr-selected-cell")?(v.removeClass("fr-visible"),!0):void(!1!==m||g.edit.isDisabled()||(h&&clearTimeout(h),h=setTimeout(t,30,e))))}function n(){h&&clearTimeout(h),v.hasClass("fr-visible")&&v.removeClass("fr-visible").removeData("instance")}function r(){m=!0,n()}function u(){m=!1}function p(e){if(!g.core.sameInstance(v))return!0;e.preventDefault(),v.removeClass("fr-visible").removeData("instance");var t=v.data("tag1"),n=v.data("tag2"),r=g.html.defaultTag();null==t?r&&"TD"!=n.parent().get(0).tagName&&0===n.parents(r).length?n.before("<"+r+">"+b.FE.MARKERS+"<br></"+r+">"):n.before(b.FE.MARKERS+"<br>"):r&&"TD"!=t.parent().get(0).tagName&&0===t.parents(r).length?t.after("<"+r+">"+b.FE.MARKERS+"<br></"+r+">"):t.after(b.FE.MARKERS+"<br>"),g.selection.restore()}function d(){g.shared.$line_breaker||(g.shared.$line_breaker=b('<div class="fr-line-breaker"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+g.language.translate("Break")+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect x="21" y="11" width="2" height="8"/><rect x="14" y="17" width="7" height="2"/><path d="M14.000,14.000 L14.000,22.013 L9.000,18.031 L14.000,14.000 Z"/></svg></a></div>')),v=g.shared.$line_breaker,g.events.on("shared.destroy",function(){v.html("").removeData().remove(),v=null},!0),g.events.on("destroy",function(){v.removeData("instance").removeClass("fr-visible").appendTo("body:first"),clearTimeout(h)},!0),g.events.$on(v,"mousemove",function(e){e.stopPropagation()},!0),g.events.$on(v,"mousedown","a",function(e){e.stopPropagation()},!0),g.events.$on(v,"click","a",p,!0)}function c(){if(!g.$wp)return!1;d(),m=!1,g.events.$on(g.$win,"mousemove",e),g.events.$on(b(g.win),"scroll",n),g.events.on("popups.show.table.edit",n),g.events.on("commands.after",n),g.events.$on(b(g.win),"mousedown",r),g.events.$on(b(g.win),"mouseup",u)}var v,m,h;return{_init:c}}});