!function(i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),i(t)}:i(window.jQuery)}(function(Ae){Ae.extend(Ae.FE.POPUP_TEMPLATES,{"video.insert":"[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_][_UPLOAD_LAYER_][_PROGRESS_BAR_]","video.edit":"[_BUTTONS_]","video.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Ae.extend(Ae.FE.DEFAULTS,{videoAllowedTypes:["mp4","webm","ogg"],videoAllowedProviders:[".*"],videoDefaultAlign:"center",videoDefaultDisplay:"block",videoDefaultWidth:600,videoEditButtons:["videoReplace","videoRemove","|","videoDisplay","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoByURL","videoEmbed","videoUpload"],videoMaxSize:52428800,videoMove:!0,videoResize:!0,videoSizeButtons:["videoBack","|"],videoSplitHTML:!1,videoTextNear:!0,videoUploadMethod:"POST",videoUploadParam:"file",videoUploadParams:{},videoUploadToS3:!1,videoUploadURL:"https://i.froala.com/upload"}),Ae.FE.VIDEO_PROVIDERS=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"//www.youtube.com/embed/$1",html:'<iframe width="640" height="360" src="{url}?wmode=opaque" frameborder="0" allowfullscreen></iframe>',provider:"youtube"},{test_regex:/^.*(?:vimeo.com)\/(?:channels(\/\w+\/)?|groups\/*\/videos\/\u200b\d+\/|video\/|)(\d+)(?:$|\/|\?)/,url_regex:/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/i,url_text:"//player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vimeo"},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"//www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"dailymotion"},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"yahoo"},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"//rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"rutube"},{test_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&\/]+)\/?(?:[^_.&]+)?/,url_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&\/]+)\/?(?:[^_.&]+)?/g,url_text:"//play.vidyard.com/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vidyard"}],Ae.FE.VIDEO_EMBED_REGEX=/^\W*((<iframe.*><\/iframe>)|(<embed.*>))\W*$/i,Ae.FE.PLUGINS.video=function(v){function p(){var e=v.popups.get("video.insert");e.find(".fr-video-by-url-layer input").val("").trigger("change");var t=e.find(".fr-video-embed-layer textarea");t.val("").trigger("change"),(t=e.find(".fr-video-upload-layer input")).val("").trigger("change")}function i(){var e=v.$tb.find('.fr-command[data-cmd="insertVideo"]'),t=v.popups.get("video.insert");if(t||(t=s()),l(),!t.hasClass("fr-active")){v.popups.refresh("video.insert"),v.popups.setContainer("video.insert",v.$tb);var i=e.offset().left+e.outerWidth()/2,o=e.offset().top+(v.opts.toolbarBottom?10:e.outerHeight()-10);v.popups.show("video.insert",i,o,e.outerHeight())}}function o(){var e=v.popups.get("video.edit");if(e||(e=H()),e){v.popups.setContainer("video.edit",v.$sc),v.popups.refresh("video.edit");var t=ge.find("iframe, embed, video"),i=t.offset().left+t.outerWidth()/2,o=t.offset().top+t.outerHeight();v.popups.show("video.edit",i,o,t.outerHeight())}}function s(e){if(e)return v.popups.onRefresh("video.insert",p),v.popups.onHide("image.insert",oe),!0;var t="";1<v.opts.videoInsertButtons.length&&(t='<div class="fr-buttons">'+v.button.buildList(v.opts.videoInsertButtons)+"</div>");var i,o="",r=v.opts.videoInsertButtons.indexOf("videoUpload"),s=v.opts.videoInsertButtons.indexOf("videoByURL"),n=v.opts.videoInsertButtons.indexOf("videoEmbed");0<=s&&(i=" fr-active",(r<s&&0<=r||n<s&&0<=n)&&(i=""),o='<div class="fr-video-by-url-layer fr-layer'+i+'" id="fr-video-by-url-layer-'+v.id+'"><div class="fr-input-line"><input id="fr-video-by-url-layer-text-'+v.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertByURL" tabIndex="2" role="button">'+v.language.translate("Insert")+"</button></div></div>");var a="";0<=n&&(i=" fr-active",(r<n&&0<=r||s<n&&0<=s)&&(i=""),a='<div class="fr-video-embed-layer fr-layer'+i+'" id="fr-video-embed-layer-'+v.id+'"><div class="fr-input-line"><textarea id="fr-video-embed-layer-text'+v.id+'" type="text" placeholder="'+v.language.translate("Embedded Code")+'" tabIndex="1" aria-required="true" rows="5"></textarea></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertEmbed" tabIndex="2" role="button">'+v.language.translate("Insert")+"</button></div></div>");var d="";0<=r&&(i=" fr-active",(n<r&&0<=n||s<r&&0<=s)&&(i=""),d='<div class="fr-video-upload-layer fr-layer'+i+'" id="fr-video-upload-layer-'+v.id+'"><strong>'+v.language.translate("Drop video")+"</strong><br>("+v.language.translate("or click")+')<div class="fr-form"><input type="file" accept="video/'+v.opts.videoAllowedTypes.join(", video/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-video-upload-layer-'+v.id+'" role="button"></div></div>');var l={buttons:t,by_url_layer:o,embed_layer:a,upload_layer:d,progress_bar:'<div class="fr-video-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="videoDismissError" tabIndex="2" role="button">OK</button></div></div>'},f=v.popups.create("video.insert",l);return N(f),f}function e(e){var t,i,o=v.popups.get("video.insert");if(!ge&&!v.opts.toolbarInline){var r=v.$tb.find('.fr-command[data-cmd="insertVideo"]');t=r.offset().left+r.outerWidth()/2,i=r.offset().top+(v.opts.toolbarBottom?10:r.outerHeight()-10)}v.opts.toolbarInline&&(i=o.offset().top-v.helpers.getPX(o.css("margin-top")),o.hasClass("fr-above")&&(i+=o.outerHeight())),o.find(".fr-layer").removeClass("fr-active"),o.find(".fr-"+e+"-layer").addClass("fr-active"),v.popups.show("video.insert",t,i,0),v.accessibility.focusPopup(o)}function t(e){v.popups.get("video.insert").find(".fr-video-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)}function a(e){v.popups.get("video.insert").find(".fr-video-embed-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)}function n(e){v.popups.get("video.insert").find(".fr-video-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)}function r(e){v.events.focus(!0),v.selection.restore();var t=!1;ge&&(ie(),t=!0),v.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video">'+e+"</span>",!1,v.opts.videoSplitHTML),v.popups.hide("video.insert");var i=v.$el.find(".fr-jiv");i.removeClass("fr-jiv"),re(i,v.opts.videoDefaultDisplay,v.opts.videoDefaultAlign),i.toggleClass("fr-draggable",v.opts.videoMove),v.events.trigger(t?"video.replaced":"video.inserted",[i])}function u(){var e=Ae(this);v.popups.hide("video.insert"),e.removeClass("fr-uploading"),e.parent().next().is("br")&&e.parent().next().remove(),b(e.parent()),v.events.trigger("video.loaded",[e.parent()])}function d(a,e,d,l,f){v.edit.off(),h("Loading video"),e&&(a=v.helpers.sanitizeURL(a));var t=function(){var e,t;if(l){v.undo.canDo()||l.find("video").hasClass("fr-uploading")||v.undo.saveStep();var i=l.find("video").data("fr-old-src"),o=l.data("fr-replaced");l.data("fr-replaced",!1),v.$wp?((e=l.clone()).find("video").removeData("fr-old-src").removeClass("fr-uploading"),e.find("video").off("canplay"),i&&l.find("video").attr("src",i),l.replaceWith(e)):e=l;for(var r=e.find("video").get(0).attributes,s=0;s<r.length;s++){var n=r[s];0===n.nodeName.indexOf("data-")&&e.find("video").removeAttr(n.nodeName)}if(void 0!==d)for(t in d)d.hasOwnProperty(t)&&"link"!=t&&e.find("video").attr("data-"+t,d[t]);e.find("video").on("canplay",u),e.find("video").attr("src",a),v.edit.on(),k(),v.undo.saveStep(),v.$el.blur(),v.events.trigger(o?"video.replaced":"video.inserted",[e,f])}else e=A(a,d,u),k(),v.undo.saveStep(),v.events.trigger("video.inserted",[e,f])};c("Loading video"),t()}function c(e){var t=v.popups.get("video.insert");if(t||(t=s()),t.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),t.find(".fr-video-progress-bar-layer").addClass("fr-active"),t.find(".fr-buttons").hide(),ge){var i=ge.find("video");v.popups.setContainer("video.insert",v.$sc);var o=i.offset().left+i.width()/2,r=i.offset().top+i.height();v.popups.show("video.insert",o,r,i.outerHeight())}void 0===e&&h(v.language.translate("Uploading"),0)}function l(e){var t=v.popups.get("video.insert");if(t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-video-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e||v.$el.find("video.fr-error").length)){if(v.events.focus(),v.$el.find("video.fr-error").length&&(v.$el.find("video.fr-error").parent().remove(),v.undo.saveStep(),v.undo.run(),v.undo.dropRedo()),!v.$wp&&ge){var i=ge;O(!0),v.selection.setAfter(i.find("video").get(0)),v.selection.restore()}v.popups.hide("video.insert")}}function h(e,t){var i=v.popups.get("video.insert");if(i){var o=i.find(".fr-video-progress-bar-layer");o.find("h3").text(e+(t?" "+t+"%":"")),o.removeClass("fr-error"),t?(o.find("div").removeClass("fr-indeterminate"),o.find("div > span").css("width",t+"%")):o.find("div").addClass("fr-indeterminate")}}function f(e){c();var t=v.popups.get("video.insert").find(".fr-video-progress-bar-layer");t.addClass("fr-error");var i=t.find("h3");i.text(e),v.events.disableBlur(),i.focus()}function g(e){void 0===e&&(e=v.popups.get("video.insert").find('.fr-video-by-url-layer input[type="text"]').val()||"");var t=null;if(v.helpers.isURL(e))for(var i=0;i<Ae.FE.VIDEO_PROVIDERS.length;i++){var o=Ae.FE.VIDEO_PROVIDERS[i];if(o.test_regex.test(e)&&new RegExp(v.opts.videoAllowedProviders.join("|")).test(o.provider)){t=e.replace(o.url_regex,o.url_text),t=o.html.replace(/\{url\}/,t);break}}t?r(t):v.events.trigger("video.linkError",[e])}function m(e){void 0===e&&(e=v.popups.get("video.insert").find(".fr-video-embed-layer textarea").val()||""),0!==e.length&&Ae.FE.VIDEO_EMBED_REGEX.test(e)?r(e):v.events.trigger("video.codeError",[e])}function b(e){F.call(e.get(0))}function y(e){try{if(!1===v.events.trigger("video.uploaded",[e],!0))return v.edit.on(),!1;var t=JSON.parse(e);return t.link?t:(Y(ye,e),!1)}catch(i){return Y(we,e),!1}}function E(e){try{var t=Ae(e).find("Location").text(),i=Ae(e).find("Key").text();return!1===v.events.trigger("video.uploadedToS3",[t,i,e],!0)?(v.edit.on(),!1):t}catch(s){return Y(we,e),!1}}function w(e){h("Loading video");var t=this.status,i=this.response,o=this.responseXML,r=this.responseText;try{if(v.opts.videoUploadToS3)if(201==t){var s=E(o);s&&d(s,!1,[],e,i||o)}else Y(we,i||o);else if(200<=t&&t<300){var n=y(r);n&&d(n.link,!1,n,e,i||r)}else Y(Ee,i||r)}catch(a){Y(we,i||r)}}function C(){Y(we,this.response||this.responseText||this.responseXML)}function _(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;h(v.language.translate("Uploading"),t)}}function x(){v.edit.on(),l(!0)}function A(e,t,i){var o,r="";if(t&&void 0!==t)for(o in t)t.hasOwnProperty(o)&&"link"!=o&&(r+=" data-"+o+'="'+t[o]+'"');var s=v.opts.videoDefaultWidth;s&&"auto"!=s&&(s+="px");var n=Ae('<span contenteditable="false" draggable="true" class="fr-video fr-dv'+v.opts.videoDefaultDisplay[0]+("center"!=v.opts.videoDefaultAlign?" fr-fv"+v.opts.videoDefaultAlign[0]:"")+'"><video src="'+e+'" '+r+(s?' style="width: '+s+';" ':"")+" controls>"+v.language.translate("Your browser does not support HTML5 video.")+"</video></span>");n.toggleClass("fr-draggable",v.opts.videoMove),v.edit.on(),v.events.focus(!0),v.selection.restore(),v.undo.saveStep(),v.opts.videoSplitHTML?v.markers.split():v.markers.insert();var a=v.$el.find(".fr-marker");return v.node.isLastSibling(a)&&a.parent().hasClass("fr-deletable")&&a.insertAfter(a.parent()),a.replaceWith(n),v.html.wrap(),v.selection.clear(),n.find("video").get(0).readyState>n.find("video").get(0).HAVE_FUTURE_DATA||v.helpers.isIOS()?i.call(n.find("video").get(0)):n.find("video").on("canplaythrough load",i),n}function S(e){if(!v.core.sameInstance(he))return!0;e.preventDefault(),e.stopPropagation();var t=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),i=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!t||!i)return!1;if("mousedown"==e.type){var o=v.$oel.get(0).ownerDocument,r=o.defaultView||o.parentWindow,s=!1;try{s=r.location!=r.parent.location&&!(r.$&&r.$.FE)}catch(n){}s&&r.frameElement&&(t+=v.helpers.getPX(Ae(r.frameElement).offset().left)+r.frameElement.clientLeft,i=e.clientY+v.helpers.getPX(Ae(r.frameElement).offset().top)+r.frameElement.clientTop)}v.undo.canDo()||v.undo.saveStep(),(ce=Ae(this)).data("start-x",t),ce.data("start-y",i),ue.show(),v.popups.hideAll(),L()}function D(e){if(!v.core.sameInstance(he))return!0;if(ce){e.preventDefault();var t=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),i=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!t||!i)return!1;var o=ce.data("start-x"),r=ce.data("start-y");ce.data("start-x",t),ce.data("start-y",i);var s=t-o,n=i-r,a=ge.find("iframe, embed, video"),d=a.width(),l=a.height();(ce.hasClass("fr-hnw")||ce.hasClass("fr-hsw"))&&(s=0-s),(ce.hasClass("fr-hnw")||ce.hasClass("fr-hne"))&&(n=0-n),a.css("width",d+s),a.css("height",l+n),a.removeAttr("width"),a.removeAttr("height"),B()}}function R(e){if(!v.core.sameInstance(he))return!0;ce&&ge&&(e&&e.stopPropagation(),ce=null,ue.hide(),B(),o(),v.undo.saveStep())}function U(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function I(e,t,i,o){return e.pageX=t,e.pageY=t,S.call(this,e),e.pageX=e.pageX+i*Math.floor(Math.pow(1.1,o)),e.pageY=e.pageY+i*Math.floor(Math.pow(1.1,o)),D.call(this,e),R.call(this,e),++o}function $(){var e;if(v.shared.$video_resizer?(he=v.shared.$video_resizer,ue=v.shared.$vid_overlay,v.events.on("destroy",function(){he.removeClass("fr-active").appendTo(Ae("body:first"))},!0)):(v.shared.$video_resizer=Ae('<div class="fr-video-resizer"></div>'),he=v.shared.$video_resizer,v.events.$on(he,"mousedown",function(e){e.stopPropagation()},!0),v.opts.videoResize&&(he.append(U("nw")+U("ne")+U("sw")+U("se")),v.shared.$vid_overlay=Ae('<div class="fr-video-overlay"></div>'),ue=v.shared.$vid_overlay,e=he.get(0).ownerDocument,Ae(e).find("body:first").append(ue))),v.events.on("shared.destroy",function(){he.html("").removeData().remove(),he=null,v.opts.videoResize&&(ue.remove(),ue=null)},!0),v.helpers.isMobile()||v.events.$on(Ae(v.o_win),"resize.video",function(){O(!0)}),v.opts.videoResize){e=he.get(0).ownerDocument,v.events.$on(he,v._mousedown,".fr-handler",S),v.events.$on(Ae(e),v._mousemove,D),v.events.$on(Ae(e.defaultView||e.parentWindow),v._mouseup,R),v.events.$on(ue,"mouseleave",R);var o=1,r=null,s=0;v.events.on("keydown",function(e){if(ge){var t=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey,i=e.which;(i!==r||200<e.timeStamp-s)&&(o=1),(i==Ae.FE.KEYCODE.EQUALS||v.browser.mozilla&&i==Ae.FE.KEYCODE.FF_EQUALS)&&t&&!e.altKey?o=I.call(this,e,1,1,o):(i==Ae.FE.KEYCODE.HYPHEN||v.browser.mozilla&&i==Ae.FE.KEYCODE.FF_HYPHEN)&&t&&!e.altKey&&(o=I.call(this,e,2,-1,o)),r=i,s=e.timeStamp}}),v.events.on("keyup",function(){o=1})}}function k(){var e,t=Array.prototype.slice.call(v.el.querySelectorAll("video")),i=[];for(e=0;e<t.length;e++)i.push(t[e].getAttribute("src")),Ae(t[e]).toggleClass("fr-draggable",v.opts.videoMove),""===t[e].getAttribute("class")&&t[e].removeAttribute("class"),""===t[e].getAttribute("style")&&t[e].removeAttribute("style");if(me)for(e=0;e<me.length;e++)i.indexOf(me[e].getAttribute("src"))<0&&v.events.trigger("video.removed",[Ae(me[e])]);me=t}function B(){he||$(),(v.$wp||v.$sc).append(he),he.data("instance",v);var e=ge.find("iframe, embed, video");he.css("top",(v.opts.iframe?e.offset().top-1+v.$iframe.position().top:e.offset().top-v.$wp.offset().top-1)+v.$wp.scrollTop()).css("left",(v.opts.iframe?e.offset().left-1:e.offset().left-v.$wp.offset().left-1)+v.$wp.scrollLeft()).css("width",e.outerWidth()).css("height",e.height()).addClass("fr-active")}function F(e){if(e&&"touchend"==e.type&&be)return!0;if(e&&v.edit.isDisabled())return e.stopPropagation(),e.preventDefault(),!1;if(v.edit.isDisabled())return!1;for(var t=0;t<Ae.FE.INSTANCES.length;t++)Ae.FE.INSTANCES[t]!=v&&Ae.FE.INSTANCES[t].events.trigger("video.hideResizer");v.toolbar.disable(),v.helpers.isMobile()&&(v.events.disableBlur(),v.$el.blur(),v.events.enableBlur()),ge=Ae(this),Ae(this).addClass("fr-active"),v.opts.iframe&&v.size.syncIframe(),le(),B(),o(),v.selection.clear(),v.button.bulkRefresh(),v.events.trigger("image.hideResizer")}function O(e){ge&&(T()||!0===e)&&(he.removeClass("fr-active"),v.toolbar.enable(),ge.removeClass("fr-active"),ge=null,L())}function z(){v.shared.vid_exit_flag=!0}function L(){v.shared.vid_exit_flag=!1}function T(){return v.shared.vid_exit_flag}function P(e){var t=e.originalEvent.dataTransfer;if(t&&t.files&&t.files.length){var i=t.files[0];if(i&&i.type&&-1!==i.type.indexOf("video")){v.markers.remove(),v.markers.insertAtPoint(e.originalEvent),v.$el.find(".fr-marker").replaceWith(Ae.FE.MARKERS),v.popups.hideAll();var o=v.popups.get("video.insert");return o||(o=s()),v.popups.setContainer("video.insert",v.$sc),v.popups.show("video.insert",e.originalEvent.pageX,e.originalEvent.pageY),c(),0<=v.opts.videoAllowedTypes.indexOf(i.type.replace(/video\//g,""))?M(t.files):Y(_e),e.preventDefault(),e.stopPropagation(),!1}}}function M(e){if(void 0!==e&&0<e.length){if(!1===v.events.trigger("video.beforeUpload",[e]))return!1;var t,i=e[0];if(i.size>v.opts.videoMaxSize)return Y(Ce),!1;if(v.opts.videoAllowedTypes.indexOf(i.type.replace(/video\//g,""))<0)return Y(_e),!1;if(v.drag_support.formdata&&(t=v.drag_support.formdata?new FormData:null),t){var o;if(!1!==v.opts.videoUploadToS3)for(o in t.append("key",v.opts.videoUploadToS3.keyStart+(new Date).getTime()+"-"+(i.name||"untitled")),t.append("success_action_status","201"),t.append("X-Requested-With","xhr"),t.append("Content-Type",i.type),v.opts.videoUploadToS3.params)v.opts.videoUploadToS3.params.hasOwnProperty(o)&&t.append(o,v.opts.videoUploadToS3.params[o]);for(o in v.opts.videoUploadParams)v.opts.videoUploadParams.hasOwnProperty(o)&&t.append(o,v.opts.videoUploadParams[o]);t.append(v.opts.videoUploadParam,i);var r=v.opts.videoUploadURL;v.opts.videoUploadToS3&&(r=v.opts.videoUploadToS3.uploadURL?v.opts.videoUploadToS3.uploadURL:"https://"+v.opts.videoUploadToS3.region+".amazonaws.com/"+v.opts.videoUploadToS3.bucket);var s=v.core.getXHR(r,v.opts.videoUploadMethod);s.onload=function(){w.call(s,ge)},s.onerror=C,s.upload.onprogress=_,s.onabort=x,c(),v.events.disableBlur(),v.edit.off(),v.events.enableBlur();var n=v.popups.get("video.insert");n&&n.off("abortUpload").on("abortUpload",function(){4!=s.readyState&&s.abort()}),s.send(t)}}}function N(o){v.events.$on(o,"dragover dragenter",".fr-video-upload-layer",function(){return Ae(this).addClass("fr-drop"),!1},!0),v.events.$on(o,"dragleave dragend",".fr-video-upload-layer",function(){return Ae(this).removeClass("fr-drop"),!1},!0),v.events.$on(o,"drop",".fr-video-upload-layer",function(e){e.preventDefault(),e.stopPropagation(),Ae(this).removeClass("fr-drop");var t=e.originalEvent.dataTransfer;if(t&&t.files){var i=o.data("instance")||v;i.events.disableBlur(),i.video.upload(t.files),i.events.enableBlur()}},!0),v.helpers.isIOS()&&v.events.$on(o,"touchstart",'.fr-video-upload-layer input[type="file"]',function(){Ae(this).trigger("click")},!0),v.events.$on(o,"change",'.fr-video-upload-layer input[type="file"]',function(){if(this.files){var e=o.data("instance")||v;e.events.disableBlur(),o.find("input:focus").blur(),e.events.enableBlur(),e.video.upload(this.files)}Ae(this).val("")},!0)}function V(){v.events.on("drop",P,!0),v.events.on("mousedown window.mousedown",z),v.events.on("window.touchmove",L),v.events.on("mouseup window.mouseup",O),v.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&O()}),v.events.on("blur video.hideResizer commands.undo commands.redo element.dropped",function(){O(!0)})}function Y(e,t){v.edit.on(),ge&&ge.find("video").addClass("fr-error"),f(v.language.translate("Something went wrong. Please try again.")),v.events.trigger("video.error",[{code:e,message:xe[e]},t])}function H(){var e="";if(0<v.opts.videoEditButtons.length){e+='<div class="fr-buttons">',e+=v.button.buildList(v.opts.videoEditButtons);var t={buttons:e+="</div>"},i=v.popups.create("video.edit",t);return v.events.$on(v.$wp,"scroll.video-edit",function(){ge&&v.popups.isVisible("video.edit")&&(v.events.disableBlur(),b(ge))}),i}return!1}function X(){if(ge){var e=v.popups.get("video.size"),t=ge.find("iframe, embed, video");e.find('input[name="width"]').val(t.get(0).style.width||t.attr("width")).trigger("change"),e.find('input[name="height"]').val(t.get(0).style.height||t.attr("height")).trigger("change")}}function K(){var e=v.popups.get("video.size");e||(e=W()),l(),v.popups.refresh("video.size"),v.popups.setContainer("video.size",v.$sc);var t=ge.find("iframe, embed, video"),i=t.offset().left+t.width()/2,o=t.offset().top+t.height();v.popups.show("video.size",i,o,t.height())}function W(e){if(e)return v.popups.onRefresh("video.size",X),!0;var t={buttons:'<div class="fr-buttons">'+v.button.buildList(v.opts.videoSizeButtons)+"</div>",size_layer:'<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-'+v.id+'"><div class="fr-video-group"><div class="fr-input-line"><input id="fr-video-size-layer-width-'+v.id+'" type="text" name="width" placeholder="'+v.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-video-size-layer-height-'+v.id+'" type="text" name="height" placeholder="'+v.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoSetSize" tabIndex="2" role="button">'+v.language.translate("Update")+"</button></div></div>"},i=v.popups.create("video.size",t);return v.events.$on(v.$wp,"scroll",function(){ge&&v.popups.isVisible("video.size")&&(v.events.disableBlur(),b(ge))}),i}function j(e){if(void 0===e&&(e=ge),e){if(e.hasClass("fr-fvl"))return"left";if(e.hasClass("fr-fvr"))return"right";if(e.hasClass("fr-dvb")||e.hasClass("fr-dvi"))return"center";if("block"==e.css("display")){if("left"==e.css("text-algin"))return"left";if("right"==e.css("text-align"))return"right"}else{if("left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function q(e){ge.removeClass("fr-fvr fr-fvl"),!v.opts.htmlUntouched&&v.opts.useClasses?"left"==e?ge.addClass("fr-fvl"):"right"==e&&ge.addClass("fr-fvr"):re(ge,Z(),e),le(),B(),o(),v.selection.clear()}function G(e){if(!ge)return!1;e.find("> *:first").replaceWith(v.icon.create("video-align-"+j()))}function Q(e,t){ge&&t.find('.fr-command[data-param1="'+j()+'"]').addClass("fr-active").attr("aria-selected",!0)}function Z(e){void 0===e&&(e=ge);var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function J(e){ge.removeClass("fr-dvi fr-dvb"),!v.opts.htmlUntouched&&v.opts.useClasses?"inline"==e?ge.addClass("fr-dvi"):"block"==e&&ge.addClass("fr-dvb"):re(ge,e,j()),le(),B(),o(),v.selection.clear()}function ee(e,t){ge&&t.find('.fr-command[data-param1="'+Z()+'"]').addClass("fr-active").attr("aria-selected",!0)}function te(){var e=v.popups.get("video.insert");e||(e=s()),v.popups.isVisible("video.insert")||(l(),v.popups.refresh("video.insert"),v.popups.setContainer("video.insert",v.$sc));var t=ge.offset().left+ge.width()/2,i=ge.offset().top+ge.height();v.popups.show("video.insert",t,i,ge.outerHeight())}function ie(){if(ge&&!1!==v.events.trigger("video.beforeRemove",[ge])){var e=ge;v.popups.hideAll(),O(!0),v.selection.setBefore(e.get(0))||v.selection.setAfter(e.get(0)),e.remove(),v.selection.restore(),v.html.fillEmptyBlocks(),v.events.trigger("video.removed",[e])}}function oe(){l()}function re(e,t,i){!v.opts.htmlUntouched&&v.opts.useClasses?(e.removeClass("fr-fvl fr-fvr fr-dvb fr-dvi"),e.addClass("fr-fv"+i[0]+" fr-dv"+t[0])):"inline"==t?(e.css({display:"inline-block"}),"center"==i?e.css({"float":"none"}):"left"==i?e.css({"float":"left"}):e.css({"float":"right"})):(e.css({display:"block",clear:"both"}),"left"==i?e.css({textAlign:"left"}):"right"==i?e.css({textAlign:"right"}):e.css({textAlign:"center"}))}function se(e){e.hasClass("fr-dvi")||e.hasClass("fr-dvb")||(e.addClass("fr-fv"+j(e)[0]),e.addClass("fr-dv"+Z(e)[0]))}function ne(e){re(e,e.hasClass("fr-dvb")?"block":e.hasClass("fr-dvi")?"inline":null,e.hasClass("fr-fvl")?"left":e.hasClass("fr-fvr")?"right":j(e)),e.removeClass("fr-dvb fr-dvi fr-fvr fr-fvl")}function ae(){v.$el.find("video").filter(function(){return 0===Ae(this).parents("span.fr-video").length}).wrap('<span class="fr-video" contenteditable="false"></span>'),v.$el.find("embed, iframe").filter(function(){if(v.browser.safari&&this.getAttribute("src")&&this.setAttribute("src",this.src),0<Ae(this).parents("span.fr-video").length)return!1;for(var e=Ae(this).attr("src"),t=0;t<Ae.FE.VIDEO_PROVIDERS.length;t++){var i=Ae.FE.VIDEO_PROVIDERS[t];if(i.test_regex.test(e)&&new RegExp(v.opts.videoAllowedProviders.join("|")).test(i.provider))return!0}return!1}).map(function(){return 0===Ae(this).parents("object").length?this:Ae(this).parents("object").get(0)}).wrap('<span class="fr-video" contenteditable="false"></span>');for(var e=v.$el.find("span.fr-video, video"),t=0;t<e.length;t++){var i=Ae(e[t]);!v.opts.htmlUntouched&&v.opts.useClasses?(se(i),v.opts.videoTextNear||i.removeClass("fr-dvi").addClass("fr-dvb")):v.opts.htmlUntouched||v.opts.useClasses||ne(i)}e.toggleClass("fr-draggable",v.opts.videoMove)}function de(){V(),v.helpers.isMobile()&&(v.events.$on(v.$el,"touchstart","span.fr-video",function(){be=!1}),v.events.$on(v.$el,"touchmove",function(){be=!0})),v.events.on("html.set",ae),ae(),v.events.$on(v.$el,"mousedown","span.fr-video",function(e){e.stopPropagation()}),v.events.$on(v.$el,"click touchend","span.fr-video",F),v.events.on("keydown",function(e){var t=e.which;return!ge||t!=Ae.FE.KEYCODE.BACKSPACE&&t!=Ae.FE.KEYCODE.DELETE?ge&&t==Ae.FE.KEYCODE.ESC?(O(!0),e.preventDefault(),!1):ge&&t!=Ae.FE.KEYCODE.F10&&!v.keys.isBrowserAction(e)?(e.preventDefault(),!1):void 0:(e.preventDefault(),ie(),!1)},!0),v.events.on("toolbar.esc",function(){if(ge)return v.events.disableBlur(),v.events.focus(),!1},!0),v.events.on("toolbar.focusEditor",function(){if(ge)return!1},!0),v.events.on("keydown",function(){v.$el.find("span.fr-video:empty").remove()}),s(!0),W(!0)}function le(){if(ge){v.selection.clear();var e=v.doc.createRange();e.selectNode(ge.get(0)),v.selection.get().addRange(e)}}function fe(){ge?(v.events.disableBlur(),ge.trigger("click")):(v.events.disableBlur(),v.selection.restore(),v.events.enableBlur(),v.popups.hide("video.insert"),v.toolbar.showInline())}function ve(e,t){if(ge){var i=v.popups.get("video.size"),o=ge.find("iframe, embed, video");o.css("width",e||i.find('input[name="width"]').val()),o.css("height",t||i.find('input[name="height"]').val()),o.get(0).style.width&&o.removeAttr("width"),o.get(0).style.height&&o.removeAttr("height"),i.find("input:focus").blur(),setTimeout(function(){ge.trigger("click")},v.helpers.isAndroid()?50:0)}}function pe(){return ge}var ue,ce,he,ge,me,be,ye=2,Ee=3,we=4,Ce=5,_e=6,xe={};return xe[1]="Video cannot be loaded from the passed link.",xe[ye]="No link in upload response.",xe[Ee]="Error during file upload.",xe[we]="Parsing response failed.",xe[Ce]="File is too large.",xe[_e]="Video file type is invalid.",xe[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",v.shared.vid_exit_flag=!1,{_init:de,showInsertPopup:i,showLayer:e,refreshByURLButton:t,refreshEmbedButton:a,refreshUploadButton:n,upload:M,insertByURL:g,insertEmbed:m,insert:r,align:q,refreshAlign:G,refreshAlignOnShow:Q,display:J,refreshDisplayOnShow:ee,remove:ie,hideProgressBar:l,showSizePopup:K,replace:te,back:fe,setSize:ve,get:pe}},Ae.FE.RegisterCommand("insertVideo",{title:"Insert Video",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("video.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("video.insert")):this.video.showInsertPopup()},plugin:"video"}),Ae.FE.DefineIcon("insertVideo",{NAME:"video-camera"}),Ae.FE.DefineIcon("videoByURL",{NAME:"link"}),Ae.FE.RegisterCommand("videoByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-by-url")},refresh:function(e){this.video.refreshByURLButton(e)}}),Ae.FE.DefineIcon("videoEmbed",{NAME:"code"}),Ae.FE.RegisterCommand("videoEmbed",{title:"Embedded Code",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-embed")},refresh:function(e){this.video.refreshEmbedButton(e)}}),Ae.FE.DefineIcon("videoUpload",{NAME:"upload"}),Ae.FE.RegisterCommand("videoUpload",{title:"Upload Video",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-upload")},refresh:function(e){this.video.refreshUploadButton(e)}}),Ae.FE.RegisterCommand("videoInsertByURL",{undo:!0,focus:!0,callback:function(){this.video.insertByURL()}}),Ae.FE.RegisterCommand("videoInsertEmbed",{undo:!0,focus:!0,callback:function(){this.video.insertEmbed()}}),Ae.FE.DefineIcon("videoDisplay",{NAME:"star"}),Ae.FE.RegisterCommand("videoDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.video.display(t)},refresh:function(e){this.opts.videoTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.video.refreshDisplayOnShow(e,t)}}),Ae.FE.DefineIcon("video-align",{NAME:"align-left"}),Ae.FE.DefineIcon("video-align-left",{NAME:"align-left"}),Ae.FE.DefineIcon("video-align-right",{NAME:"align-right"}),Ae.FE.DefineIcon("video-align-center",{NAME:"align-justify"}),Ae.FE.DefineIcon("videoAlign",{NAME:"align-center"}),Ae.FE.RegisterCommand("videoAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=Ae.FE.COMMANDS.videoAlign.options;for(var i in t)t.hasOwnProperty(i)&&(e+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="videoAlign" data-param1="'+i+'" title="'+this.language.translate(t[i])+'">'+this.icon.create("video-align-"+i)+'<span class="fr-sr-only">'+this.language.translate(t[i])+"</span></a></li>");return e+"</ul>"},callback:function(e,t){this.video.align(t)},refresh:function(e){this.video.refreshAlign(e)},refreshOnShow:function(e,t){this.video.refreshAlignOnShow(e,t)}}),Ae.FE.DefineIcon("videoReplace",{NAME:"exchange"}),Ae.FE.RegisterCommand("videoReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.video.replace()}}),Ae.FE.DefineIcon("videoRemove",{NAME:"trash"}),Ae.FE.RegisterCommand("videoRemove",{title:"Remove",callback:function(){this.video.remove()}}),Ae.FE.DefineIcon("videoSize",{NAME:"arrows-alt"}),Ae.FE.RegisterCommand("videoSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.video.showSizePopup()}}),Ae.FE.DefineIcon("videoBack",{NAME:"arrow-left"}),Ae.FE.RegisterCommand("videoBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.video.back()},refresh:function(e){this.video.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator"
).addClass("fr-hidden"))}}),Ae.FE.RegisterCommand("videoDismissError",{title:"OK",undo:!1,callback:function(){this.video.hideProgressBar(!0)}}),Ae.FE.RegisterCommand("videoSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.video.setSize()}})});